# Section 19 - Rule 19-39                 
**Schema Version:** 0.0.24      
**Mandatory Rule:** True    
**Rule ID:** 19-39                   
**Rule Description:**  For baseline systems serving only laboratory spaces that are prohibited from recirculating return air by code or accreditation standards, the baseline system shall be modeled as 100% outdoor air. 

**Rule Assertion:** Options are Pass/Fail/UNDETERMINED/NOT_APPLICABLE     
**Appendix G Section:** G3.1.2.5 Exception 4           
**90.1 Section Reference:** None  

**Data Lookup:** None    

**Evaluation Context:** Each HeatingVentilatingAirConditioningSystem  

**Applicability Checks:**  
1. Applies to lab spaces only.    
   
**Function Calls:**  
1. get_dict_of_zones_and_terminal_units_served_by_hvac_sys()    
2. get_fan_system_object_supply_return_exhaust_relief_total_kW_CFM() 
3. match_data_element()  
4. get_component_by_id()  
5. get_min_OA_CFM_sch_zone()  
6. aggregate_min_OA_schedule_across_zones()  

## Rule Logic:   
**Applicability Check 1:**  Checks each HVAC system for applicability  (does it serve only labs) otherwise outcome is NOT_APPLICABLE
- Create dictionary of hvac systems and associated zones and terminal units for the baseline: `dict_of_zones_and_terminal_units_served_by_hvac_sys_b = get_dict_of_zones_and_terminal_units_served_by_hvac_sys(B_RMI)`   
- For each hvac system in the B_RMI: `for hvac in B_RMI...HeatingVentilatingAirConditioningSystem:`  
    - Reset modeled_100_percent_OA boolean variable to false: `modeled_100_percent_OA = false`  
    - Reset hvac_system_serves_only_labs boolean variable to true: `hvac_system_serves_only_labs = true`  
    - Get list of zones served by the hvac system: `zones_list_hvac_sys_b = dict_of_zones_and_terminal_units_served_by_hvac_sys_b[hvac.id]["ZONE_LIST"]`  
    - For each zone associated with the HVAC system: `for zone in zones_list_hvac_sys_b:`  
        - For each space types associated with the zone, check if any spaces are NOT labs: `for space in zone.spaces:`
            - Check if the lighting space type is NOT a lab: `if space.lighting_space_type not in [LABORATORY_EXCEPT_IN_OR_AS_A_CLASSROOM]: hvac_system_serves_only_labs = false`    
    - Check if hvac_system_serves_only_labs equal true, if yes then carry on, if not then outcome is NOT_APPLICABLE: `if outcome is NOT_APPLICABLE == True:`  
        - Set counter equal to 0: `counter = 0`  
        - For each zone associated with the HVAC system: `for zone in zones_list_hvac_sys_b:`  
            - Add each zone's OA CFM schedule to the list of zone OA CFM schedules for the baseline: `zone_OA_CFM_list_of_schedules_b[counter] = get_min_OA_CFM_sch_zone(B_RMI, zone.id)`  
            - Get the analogous zone object from the proposed RMI (if this is not strictly the correct syntax please advise Weili): `zone_p = get_component_by_id(P_RMI,match_data_element(P_RMI,Zone,zone.id))`    
            - Add each zone's OA CFM schedule to the list of zone OA CFM schedules for the proposed: `zone_OA_CFM_list_of_schedules_p[counter] = get_min_OA_CFM_sch_zone(P_RMI, zone_p.id)`  
            - Add to counter: `counter = counter + 1`

        - Create aggregated OA CFM schedule for the baseline for the zones served by the hvac system: `aggregated_min_OA_schedule_across_zones_b = aggregate_min_OA_schedule_across_zones(B_RMI,zone_OA_CFM_list_of_schedules_b)`  
        - Create aggregated OA CFM schedule for the proposed for the zones served by the baseline hvac system: `aggregated_min_OA_schedule_across_zones_p = aggregate_min_OA_schedule_across_zones(P_RMI,zone_OA_CFM_list_of_schedules_p)`  
        - Reset OA_CFM_schedules_match boolean variable to True: `OA_CFM_schedules_match = True`  
        - Check if schedules mismatch for any hours of the year, if so set boolean to false: `for p to Range(8760):`  
            - Check if the baseline and proposed schedules mismatch: `if aggregated_min_OA_schedule_across_zones_b[p] != aggregated_min_OA_schedule_across_zones_p[p]: OA_CFM_schedule_match = false`   
        - Sum OA CFM across baseline schedule to get the total for comparison purposes in the rule assertions: `modeled_baseline_total_zone_min_OA_CFM = sum(aggregated_min_OA_schedule_across_zones_b)`  
        - Sum OA CFM across proposed schedule to get the total for comparison purposes in the rule assertions: `modeled_proposed_total_zone_min_OA_CFM = sum(aggregated_min_OA_schedule_across_zones_p)`  

        - Get the maximum_outdoor_airflow for the fan system: `max_OA_flow = hvac.fan_system.maximum_outdoor_airflow`  
        - Get the design air flow: `design_supply_flow = list(get_fan_system_object_supply_return_exhaust_relief_total_kW_CFM(B_RMI, hvac.fan_system)["Fan_CFM])[0]`  
        - Get the minimum air flow: `min_air_flow = hvac.fan_system.minimum_airflow`  
        - Get the minimum OA flow: `min_OA_flow = hvac.fan_system.minimum_outdoor_airflow` 
        - Check if it was modeled as a 100% outdoor air unit: `if if max_OA_flow == design_supply_flow and min_OA_flow == min_air_flow: modeled_100_percent_OA = true`  
        
    - **Rule Assertion:** 
    - Case 1: If the baseline system was modeled with the design supply cfm equal to the maximum OA cfm and the minimum air flow was modeled as the minimum OA flow then pass: `if modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_CFM >= modeled_proposed_total_zone_min_OA_CFM: outcome = "PASS"`  
    - Case 2: Else, fail: `Else: outcome = "Fail" and raise_message "For <insert hvac.id> either the baseline OA CFM is modeled as less than the proposed or it was not modeled as a 100% percent outdoor air unit. The modeled baseline system serves only laboratory spaces that are likely prohibited from recirculating return air by code or accreditation standards, therefore it is expected that the baseline system would be modeled as 100% outdoor air per the requirements of Section G3.1.2.5 Exception #4 and that the baseline OA cfm would not be less than the proposed."`  


**Notes/Questions:**   
1. I was not sure how exactly to assess whether a unit is 100% OA. I figure it would have to have a design supply cfm that matches the maximum OA cfm and the min supply cfm matching the min OA requirements but I don't think this guarentees 100% OA operation. 
2. How do we know for sure if the hvac system is prohibited from recirculating return air by code or accreditation standards? In light of this should, we also pass it if OA_CFM_schedule_match == true and its not modeled as 100% OA? I left in the logic for testing OA_CFM_schedule_match == true just in case.

**[Back](_toc.md)**