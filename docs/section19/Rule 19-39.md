# Section 19 - Rule 19-39                 
**Schema Version:** 0.0.24      
**Mandatory Rule:** True    
**Rule ID:** 19-39                   
**Rule Description:**  For baseline systems serving only laboratory spaces that are prohibited from recirculating return air by code or accreditation standards, the baseline system shall be modeled as 100% outdoor air. 

**Rule Assertion:** Options are Pass/Fail/UNDETERMINED/NOT_APPLICABLE     
**Appendix G Section:** G3.1.2.5 Exception 4           
**90.1 Section Reference:** None  

**Data Lookup:** None    

**Evaluation Context:** Each HeatingVentilatingAirConditioningSystem  

**Applicability Checks:**  
1. Applies to lab spaces only.    
   
**Function Calls:**  
1. get_dict_of_zones_and_terminal_units_served_by_hvac_sys()    
2. get_fan_system_object_supply_return_exhaust_relief_total_power_flow() 
3. match_data_element()  
4. get_component_by_id()  
5. get_min_OA_flow_sch_zone()  
6. aggregate_min_OA_schedule_across_zones()  

## Rule Logic:   
- Create dictionary of hvac systems and associated zones and terminal units for the baseline: `dict_of_zones_and_terminal_units_served_by_hvac_sys_b = get_dict_of_zones_and_terminal_units_served_by_hvac_sys(B_RMI)`   
- For each hvac system in the B_RMI: `for hvac in B_RMI...HeatingVentilatingAirConditioningSystem:`  
    - Reset modeled_100_percent_OA boolean variable to false: `modeled_100_percent_OA = false`  
    - Reset the possibly_modeled_100_percent_OA to false: `possibly_modeled_100_percent_OA = false`    
    - Reset the likely_NOT_modeled_100_percent_OA to false: `likely_NOT_modeled_100_percent_OA = false`  
    - Reset hvac_system_serves_only_labs boolean variable to true: `hvac_system_serves_only_labs = true`  
    - Reset all_lighting_space_types_defined boolean variable to true: `all_lighting_space_types_defined = true`  
    - Reset are_any_lighting_space_types_defined boolean variable to true: `are_any_lighting_space_types_defined = false`  
    
    - Get list of zones served by the hvac system: `zones_list_hvac_sys_b = dict_of_zones_and_terminal_units_served_by_hvac_sys_b[hvac.id]["ZONE_LIST"]`  
    
    - For each zone associated with the HVAC system: `for zone in zones_list_hvac_sys_b:`  
        - For each space associated with the zone, check if any spaces are NOT labs or if any lighting space types are not defined: `for space in zone.spaces:`
            - Check if hvac_system_serves_only_labs = true (no need to keep looping through space types if it equals false): `if hvac_system_serves_only_labs == true:`  
                - Check if the lighting space type is defined: `if space.lighting_space_type != Null:`    
                    - Set are_any_lighting_space_types_defined = true: `are_any_lighting_space_types_defined = true`  
                    - Check if the lighting space type is NOT a lab: `if space.lighting_space_type not in [LABORATORY_EXCEPT_IN_OR_AS_A_CLASSROOM]: hvac_system_serves_only_labs = false`    
                - Else (i.e., space.lighting_space_type = Null), set all_lighting_space_types_defined = true: `all_lighting_space_types_defined = false`                 

        - Add each zone's OA CFM schedule to the list of zone OA CFM schedules for the baseline: `zone_OA_flow_list_of_schedules_b[counter] = get_min_OA_flow_sch_zone(B_RMI, zone.id)`  
        - Get the analogous zone object from the proposed RMI (if this is not strictly the correct syntax please advise Weili): `zone_p = get_component_by_id(P_RMI,match_data_element(P_RMI,Zone,zone.id))`    
        - Add each zone's OA CFM schedule to the list of zone OA CFM schedules for the proposed: `zone_OA_flow_list_of_schedules_p[counter] = get_min_OA_flow_sch_zone(P_RMI, zone_p.id)`  
        - Add to counter: `counter = counter + 1`

        - Create aggregated OA CFM schedule for the baseline for the zones served by the hvac system: `aggregated_min_OA_schedule_across_zones_b = aggregate_min_OA_schedule_across_zones(B_RMI,zone_OA_flow_list_of_schedules_b)`  
        - Create aggregated OA CFM schedule for the proposed for the zones served by the baseline hvac system: `aggregated_min_OA_schedule_across_zones_p = aggregate_min_OA_schedule_across_zones(P_RMI,zone_OA_flow_list_of_schedules_p)`  
        - Reset OA_flow_schedules_match boolean variable to True: `OA_flow_schedules_match = True`  
        - Check if schedules mismatch for any hours of the year, if so set boolean to false: `for p to Range(8760):`  
            - Check if the baseline and proposed schedules mismatch: `if aggregated_min_OA_schedule_across_zones_b[p] != aggregated_min_OA_schedule_across_zones_p[p]: OA_flow_schedule_match = false`   
        - Sum OA CFM across baseline schedule to get the total for comparison purposes in the rule assertions: `modeled_baseline_total_zone_min_OA_flow = sum(aggregated_min_OA_schedule_across_zones_b)`  
        - Sum OA CFM across proposed schedule to get the total for comparison purposes in the rule assertions: `modeled_proposed_total_zone_min_OA_flow = sum(aggregated_min_OA_schedule_across_zones_p)`  

        - Get the maximum_outdoor_airflow for the fan system: `max_OA_flow = hvac.fan_system.maximum_outdoor_airflow`  
        - Get the design supply air flow: `design_supply_flow = list(get_fan_system_object_supply_return_exhaust_relief_total_power_flow(B_RMI, hvac.fan_system)["supply_fans_airflow])`  
        - Get the minimum fan system air flow: `min_air_flow = hvac.fan_system.minimum_airflow`  
        - Get the minimum fan system OA flow: `min_OA_flow = hvac.fan_system.minimum_outdoor_airflow` 
        - Check if it was modeled as a 100% outdoor air unit: `if max_OA_flow == min_OA_flow and min_OA_flow == design_supply_flow: modeled_100_percent_OA = true`  
        - Check if it possbily may have been modeled as a 100% outdoor air unit: `if if max_OA_flow == design_supply_flow and min_OA_flow == min_air_flow: possibly_modeled_100_percent_OA = true`  
        - Check if it is NOT likely that it was not modeled as a 100% outdoor air unit: `if min_OA_flow != min_air_flow: likely_NOT_modeled_100_percent_OA = true`  
        
    - **Rule Assertion:** 
    - Case 1: If the baseline system was modeled with the design supply cfm equal to the maximum OA cfm and the minimum air flow was modeled as the minimum OA flow and all space types are defined and are all lab spaces then pass: `if hvac_system_serves_only_labs == true and modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_flow >= modeled_proposed_total_zone_min_OA_flow and all_lighting_space_types_defined== true: outcome = "PASS" and raise_message "The proposed system serves lab spaces and the baseline system <insert hvac.id> was modeled as an 100% outdoor air unit per the requirements of Section G3.1.2.5 Exception #4. This meets G3.1.2.5 Exception 4 for hvac systems that are prohibited from recirculating return air by code or accreditation standards. Recommend a manual check to confirm that recirculating return air is prohibited."`  
    - Case 2: Else if the baseline system was modeled with the design supply cfm equal to the maximum OA cfm and the minimum air flow was modeled as the minimum OA flow and some spaces were defined and equal to lab then pass: `elif hvac_system_serves_only_labs == true and modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_flow >= modeled_proposed_total_zone_min_OA_flow and are_any_lighting_space_types_defined == true: outcome = "PASS" and raise_message "Baseline system <insert hvac.id> was modeled as an 100% outdoor air unit per the requirements of Section G3.1.2.5 Exception #4; however, not all space types associated with the hvac system were defined in the RMD. All defined space types were classed as lab; a manual check to confirm that this unit was modeled correctly per the rules of Section G3.1.2.5 including Exception #4 to confirm that recirculating return air is prohibited is recommended." `  
    - Case 3: Else if the baseline system was modeled with the design supply cfm equal to the maximum OA cfm and the minimum air flow was modeled as the minimum OA flow and no space types were defined then UNDETERMINED: `elif hvac_system_serves_only_labs == true and modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_flow >= modeled_proposed_total_zone_min_OA_flow and are_any_lighting_space_types_defined == false: outcome = "UNDETERMINED" and raise_message "Baseline system <insert hvac.id> appears was modeled as an 100% outdoor air unit; however, no space types associated with the hvac system were defined in the RMD. A manual check to confirm that this unit was modeled correctly per the rules of Section G3.1.2.5 including Exception #4 to confirm that recirculating return air is prohibited is recommended."`    
    - Case 4: Else if the baseline system was possibly modeled as 100% OA and all space types are defined and are all lab spaces then UNDETERMINED: `elif hvac_system_serves_only_labs == true and possibly_ modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_flow >= modeled_proposed_total_zone_min_OA_flow and all_lighting_space_types_defined== true: outcome = "UNDETERMINED" and raise_message "The proposed system serves lab spaces and it could not be determined definitively whether baseline system <insert hvac.id> was modeled as a 100% outdoor air system. This would be required to meet G3.1.2.5 Exception 4 for baseline hvac systems exclusively serving labs that are prohibited from recirculating return air by code or accreditation standards. Recommend a manual check to confirm that recirculating return air is prohibited and, if so, that the baseline hvac system is modeled as a 100% OA system."`  
    - Case 5: Else if the baseline system was was possibly modeled as 100% OA and some spaces were defined and equal to lab then UNDETERMINED: `elif hvac_system_serves_only_labs == true and possibly_ modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_flow >= modeled_proposed_total_zone_min_OA_flow and are_any_lighting_space_types_defined == true: outcome = "UNDETERMINED" and raise_message "The proposed system appears as though it serves lab spaces; however, not all space types associated with the hvac system were defined in the RMD. G3.1.2.5 Exception 4 requires that baseline hvac systems serving only lab spaces that are prohibited from recirculating return air by code or accreditation standards be modeled as 100% outdoor systems. It could not be determined definitively whether baseline system <insert hvac.id> was modeled as a 100% outdoor air system. Recommend a manual check to confirm that recirculating return air is prohibited and, if so, that the baseline hvac system is modeled as a 100% OA system."`  
    - Case 6: Else if the baseline system was was possibly modeled as 100% OA and no space types were defined then UNDETERMINED: ` elif hvac_system_serves_only_labs == true and possibly_modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_flow >= modeled_proposed_total_zone_min_OA_flow and are_any_lighting_space_types_defined == false: outcome = "UNDETERMINED" and raise_message  "No space types associated with baseline system <insert hvac.id> were defined in the RMD and it appears that the system may have been modeled as a 100% outdoor air system. G3.1.2.5 Exception 4 requires that baseline hvac systems serving only lab spaces that are prohibited from recirculating return air by code or accreditation standards be modeled as 100% outdoor systems. It could not be determined definitively whether this baseline system was modeled as a 100% outdoor air system or if it exclusively serves lab spaces. Recommend a manual check to confirm that recirculating return air is prohibited and, if so, that the baseline hvac system is modeled as a 100% OA system."`  
    "`  
    - Case 7: Else if the baseline system was not modeled as 100% OA and no space types were defined then PASS: ` elif likey_NOT_modeled_100_percent_OA == true and modeled_baseline_total_zone_min_OA_flow == modeled_proposed_total_zone_min_OA_flow and are_any_lighting_space_types_defined == false: outcome = "PASS" and raise_message  "No space types associated with baseline system <insert hvac.id> were defined in the RMD and the system was not modeled as a 100% outdoor air system. G3.1.2.5 Exception 4 requires that baseline hvac systems serving only lab spaces that are prohibited from recirculating return air by code or accreditation standards be modeled as 100% outdoor systems. It could not be determined whether this baseline system serves only lab spaces and whether this exception is applicable. It was assumed that it does not. Recommend a manual check to ensure that the baseline system does not only serve lab spaces."`  
    - Case 8: Else if space types are not all lab: NOT_APPLICABLE: `elif hvac_system_serves_only_labs == false: outcome = "NOT_APPLICABLE"`  
    - Case 9: Else, fail: `Else: outcome = "Fail" and raise_message "For <insert hvac.id> either the baseline OA flow is modeled as less than the proposed or it was not modeled as an 100% percent outdoor air unit when excected. The modeled baseline system may serve only laboratory spaces that are likely prohibited from recirculating return air by code or accreditation standards, therefore it is expected that the baseline system would be modeled as 100% outdoor air per the requirements of Section G3.1.2.5 Exception #4 and that the baseline OA flow would not be less than the proposed."`  


**Notes/Questions:**   
1. I was not sure how exactly to assess whether a unit is 100% OA. I figure it would have to have a design supply cfm that matches the maximum OA cfm and the min supply cfm matching the min OA requirements but I don't think this guarentees 100% OA operation. 


**[Back](_toc.md)**