# Service_Water_Heating - Rule 11-3
**Schema Version:** 0.0.36  

**Mandatory Rule:** TRUE

**Rule ID:** 11-3

**Rule Description:** "Where no service water-heating system exists or has been designed and submitted with design documents but the building will have service water-heating loads, a service water-heating system shall be modeled that matches the system type in the baseline building design"

**Rule Assertion:** Options are PASS/FAIL

**Appendix G Section Reference:** Table G3.1 #11, proposed column, c

**Evaluation Context:** P-RMD each SHW bat  
**Data Lookup:**   
**Function Call:** 
- **get_component_by_id**
- **compare_context_pair** - there is no RDS for this function, but it is a function developed for Rule 1-6 that compares two elements
- **get_SHW_types_and_spaces**
- **get_SHW_equipment_connected_to_use_type**

**Applicability Checks:**
- check that the SHW type in the P_RMD has SHW loads

## Applicability Checks:
- projects without SWH in the user model are expected to have a baseline SWH system in the proposed model.  If there is SWH in the user model, we assume there is a SWH system designed, and instead rule 11-1 Applies and P_RMD matches U_RMD.
- use the function get_SWH_equipment_associated_with_each_swh_distribution_system to get a dictionary of SWH equipment associated with each Distribution System for the Proposed model (pumps, tanks, SWH use, distribution system, etc): `p_swh_system_and_equip_dict = get_SWH_equipment_associated_with_each_swh_distribution_system(P_RMD)`
- for each distribution system: `for distribution_id in p_swh_system_and_equip_dict:`
    - get the distribution system: `p_distribution = get_component_by_id(P_RMD, distribution_id)`
    - for each swh use in the dictionary, check to see that the swh use exists in the user model: `for swh_use_id in p_swh_system_and_equip_dict[distribution_id]["SPACE_USES"]:`
        - get the user swh_use: `u_swh_use = get_component_by_id(U_RMD, swh_use_id)`
        - if the u_swh_use exists, this rule is not applicable and 11-1 applies: `if(u_swh_use): NOT_APPLICABLE`
    - if the program reaches this line without being not applicable first continue to rule logic for this distribution system: `CONTINUE TO RULE LOGIC`

    ## Rule Logic: 
  - create a boolean to keep track of whether everything matches: `all_match = TRUE`
  - create an error string: `error_str = ""`
  - create the compare context string: `compare_context_str = "AppG 11-1 P_RMD Equals B_RMD"`
  - get a dictionary of all SHW equipment connected to the SHW distribution system in the proposed model: `p_shw_equipment_dict = get_SWH_equipment_associated_with_each_swh_distribution_system(P_RMD)[distribution_id]`
  - get a dictionary of all SHW equipment connected to the SHW distribution system in the baseline model: `b_shw_equipment_dict = get_SWH_equipment_associated_with_each_swh_distribution_system(B_RMD)[distribution_id]`
  - check whether b_shw_equipment_dict is equal to null.  If it is, then set all_match is false and give the user an error indictating that the system doesn't exist in the baseline: `if b_shw_equipment_dict == NULL:  all_match = FALSE; error_str = "The SHW Distribution system " + distribution_id + " is not found in the baseline model."
  - continue if all_match is still TRUE: `if all_match:`
    - create a list of all of the SHW equipment types that exist in both the proposed and baseline models: `shw_equipment_types = set(p_shw_equipment_dict.keys()) | set(b_shw_equipment_dict.keys())`
    - loop through each of the equipment types: `for shw_equipment_type in shw_equipment_types:`
      - continue if all_match is still true: `if all_match:`
        - check if this equipment type matches between the proposed and baseline models.  First check whether there are the same number equipment: `if len(p_shw_equipment_dict[shw_equipment_type]) == len(b_shw_equipment_dict[shw_equipment_type]):`
            - look at each equipment type system in the proposed model and see if there is one that is the same in the baseline model.  This check relies on the understanding that the RCT team has a method for comparing all elements within an object match (compare_context_pair): `for p_SHW_equip_id in p_shw_equipment_dict[shw_equipment_type]:`
                - if this system is in B_RMD.service_water_heating_distribution_systems, compare the systems: `if p_SHW_equip_id in b_shw_equipment_dict[shw_equipment_type]:`
                    - use compare_context_pair to compare systems and set all_match to FALSE if the systems don't compare: `if !compare_context_pair(p_SHW_equip_id, b_SHW_equip_id, $, extra_schema_for_SHW_comparison.json, true, compare_context_str, error_str): all_match = FALSE`
                - otherwise, set all_match to false: `else: all_match = FALSE`
        - otherwise, all_match is false: `all_match = FALSE`

    ## Rule Assertion: 
    - Case1: all elements are equal: PASS: `if all_match: PASS`
    - Case2: all elements don't match, FAIL: if !all_match: FAIL`

  
  **Notes:**
  1.  using compare_context_pair might not be the correct approach - this function requires data elements in the extra schema to have a tag "AppG P_RMD Equals U_RMD" - is it possible to pass in a custom json created for this rule which identifies which elements need to be equal?
  2.  is there a situation where some of the equipment shouldn't be equal?  Solar hot water, for example?
  3.  extra_schema_for_SHW_comparison.json is the json file created from SHW comparison fields.yaml

**[Back](../_toc.md)**
