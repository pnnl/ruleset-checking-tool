# ServiceWaterHeating - Rule 11-10

**Schema Version:** 0.0.37  
**Mandatory Rule:** True  
**Rule ID:** 11-10  

**Rule Description:** The service water heating system type in the baseline building design shall match the minimum efficiency requirements in Section 7.4.2  

**Rule Assertion:** Options are PASS/FAIL/NOT_APPLICABLE/UNDETERMINED  
**Appendix G Section Reference:** Table G3.1 #11, baseline column, a + b  

**Evaluation Context:** Each ServiceWaterHeatingEquipment  
**Data Lookup:**   
**Function Call:**

1. get_SHW_equipment_associated_with_each_SWH_bat()

**Applicability Checks:**
- Each SHW Equipment is applicable
- use get_SHW_equipment_associated_with_each_SWH_bat to get the SHW BATs and SHW use in the building: `shw_bats_and_equip_dict = get_SWH_components_associated_with_each_SWH_bat(B_RMD)`
- look at each SHW equipment in the building: `for swh_eq in B_RMD.service_water_heating_equipment:`
  - CONTINUE TO RULE LOGIC
- there are no cases where a Service Water Heating Equipment is not applicable to the rule
- look through each of the SHW bats in the building: `for shw_bat in shw_bats_and_equip_dict:`
  - look through each SHW Equipment: `for service_water_heating_equipment_id in shw_bats_and_equip_dict[shw_bat]: CONTINUE TO RULE LOGIC`
- if there are no SWH equipment in the RMD, then this rule will not be evaluated


    ## Rule Logic:
  - create a value to track the rule status: `rule_status = "FAIL"`
  - create a variable to track any notes: `rule_note = """`
  - find the swh_bat by looking at each swh_bat in shw_bats_and_equip_dict, and looking for the swh_eq.id in the list of SWHHeatingEq for each BAT.  Start by setting the swh_bat to "NONE: `swh_bat = "NONE"`
  - look at each swh building area type: `for swh_bat1 in shw_bats_and_equip_dict:`
    - look for the id of the swh_eq in the SWHHeatingEq list: `if swh_eq.id in? shw_bats_and_equip_dict[swh_bat1]["SWHHeatingEq"]:`
      - set the swh_bat to swh_bat1: `swh_bat = swh_bat1`
      - and break out of the loop: `break`
  - check if the swh_bat is still NONE we cannot evaluate the rule, create a note, and go to rule assertion: `if swh_bat == "NONE"; rule_note = "We were not able to identify the building area type for this service water heater, so the rule will not be evaluated."; GO TO RULE ASSERTION`
  - we need to find the following information about the SWH:
    - swh_type - one of the SWH BATs
    - input_capacity (btu/hr)
    - storage_volume (gallons)
    - draw_pattern (VERY_SMALL, LOW, MEDIUM, or HIGH)
    - capacity_per_volume (btu/hr/gallon)
  - get the service water heating system: `swh_eq = get_object_by_id(service_water_heating_equipment_id,RMD)`
  - get the type of tank: `tank_type = swh_eq.tank.type`
  - the swh_type will be one of the ServiceWaterHeaterTankOptions, which are more detailed than the four types we need.  Determine our type based on the detailed type.
  - the default value of swh_type is OTHER.  If the swh_type can be identified, the value will be changed in the logic below: `swh_type = "OTHER"`
  - if the tank_type is CONSUMER_INSTANTANEOUS, COMMERCIAL_INSTANTANEOUS, or RESIDENTIAL_DUTY_COMMERCIAL_INSTANTANEOUS, set the swh_type to INSTANTANEOUS and go to rule assertion: `if tank_type in ["CONSUMER_INSTANTANEOUS", "COMMERCIAL_INSTANTANEOUS", "RESIDENTIAL_DUTY_COMMERCIAL_INSTANTANEOUS"]: swh_type = "INSTANTANEOUS"`; GO TO RULE_ASSERTION

  - get the fuel type of the equipment: `fuel_type = shw_eq.heater_fuel_type`
  - if the tank_type is CONSUMER_STORAGE or COMMERCIAL_STORAGE, set the swh_type to STORAGE for the fuel type: `if tank_type in ["CONSUMER_STORAGE", "COMMERCIAL_STORAGE"]:`
    - set the swh_type based on tank_type and fuel type: `if fuel_type == "ELECTRICITY": swh_type = "ELECTRIC_RESISTANCE_STORAGE`
    - `elif fuel_type == "NATURAL_GAS": swh_type = "GAS_STORAGE`
    - if the fuel type is propane, this is treated as natural gas in Table 7.8: `elif fuel_type == "PROPANE": swh_type = "GAS_STORAGE"`
    - if the fuel type is not Electricity, Natural Gas, or Propane, this is not a valid baseline SWH system.  Create a rule note and go directly to the rule assertion: `else: rule_note += "Fuel type: " + fuel_type + " is not a valid fuel type for a service water heating baseline system.  According to ASHRAE 90.1 Table G3.1.1-2 service water heating equipment shall be either electric resistance or natural gas.  According to ASHRAE 90.1 Table G3.1 #11 h, in cases where natural gas is specified as the baseline system, but there is no natural gas available on site, a propane system may be modeled.  " `
  - if the draw_pattern is given, get the draw pattern: `if shw_eq.draw_pattern != null: draw_pattern = shw_eq.draw_pattern`
  - otherwise, determine the draw pattern based off the first_hour_rating of the shw_eq: `else:`
    - First get the first hour rating (gallons): `first_hour_rating = shw_eq.first_hour_rating`
    - if the first_hour_rating is less than 18 gallons, draw_pattern is "VERY SMALL": `if first_hour_rating < 18: draw_pattern = "VERY_SMALL"`
    - otherwise if the first_hour_rating is less than 51 gallons, draw pattern is LOW: `elif first_hour_rating < 51: draw_pattern = "LOW"`
    - otherwise if the first_hour_rating is less than 75 gallons, draw pattern is MEDIUM: `elif first_hour_rating < 75: draw_pattern = "MEDIUM"`
    - otherwise draw pattern is HIGH: `else: draw_pattern = "HIGH"`
  - get the capacity of the SHW system (make sure to convert to btu/hr): `input_capacity = swh_eq.input_power`
  - get the volume of the tank (make sure to convert to gallons): `storage_volume = swh_eq.distribution_system.tank.storage_capacity`
  - calculate the capacity_per_volume based on the input_capacity and the storage_volume: `capacity_per_volume = shw_eq.rated_capacity / storage_volume`
  - get the efficiency metric values: `efficiency_metric_values = swh_eq.efficiency_metric_values`
  - get the efficiency metric types: `efficiency_metric_types = swh_eq.efficiency_metric_types`
  - create a dictionary of the efficiency data: `efficiency_metric_dict = dict(zip(efficiency_metric_types, efficiency_metric_values))
  - get the thermal efficiency: `thermal_efficiency = efficiency_metric_dict["THERMAL_EFFICIENCY"]`
  - get the uniform energy factor: `uniform_energy_factor = efficiency_metric_dict["UNIFORM_ENERGY_FACTOR"]`
  - what follows is logic that implements Table 7.8 - this table has multiple criteria, so I think it's simpler to implement with if / else logic than a table lookup
  - if the swh_type is OTHER, set rule_note to "Water heater type is not a recognized type", and continue to rule assertion: `if swh_type == "OTHER": rule_note = "Water heater type is not a recognized type"; GO TO RULE ASSERTION`
  - create a boolean has_fault and set it to false: `has_fault = false`
  - if the water heater is electric resistance, or storage and the capacity is <= 12kW (40945 btu/hr), look at Appendix F: `if swh_type in ["ELECTRIC_RESISTANCE_STORAGE"] and input_capacity <= 40945.7:`
    - check the size of the storage tank.  If it's less than 2 gallons, provide a note, and continue to rule assertion: `if storage_volume < 2: rule_note = "The storage volume is not consistent with an electric storage water heater as it is less than 20 gallons."; GO TO RULE ASSERTION`
    - else, if the storage tank is is between 20 and 55 gallons, this is considered an electric storage water heater in Appendix F: `elif storage_volume >= 20 and storage_volume <= 55:`
      - determine the UEF based on the draw pattern for VERY_SMALL: `if draw_pattern == "VERY_SMALL": expected_uef = 0.8808 – (0.0008 × storage_volume)`
      - determine the UEF based on the draw pattern for LOW: `if draw_pattern == "LOW": expected_uef = 0.9254 – (0.0003 × storage_volume)`
      - determine the UEF based on the draw pattern for MEDIUM: `if draw_pattern == "MEDIUM": expected_uef = 0.9307 – (0.0002 × storage_volume)`
      - determine the UEF based on the draw pattern for HIGH: `if draw_pattern == "HIGH": expected_uef = 0.9349 – (0.0001 × storage_volume)`
      - check whether the uniform_energy_factor is valid: `if uniform_energy_factor != NULL
        - check if the actual uniform_energy_factor equals the expected: `if uniform_energy_factor == expected_UEF:`
          - set rule_status to "PASS": `rule_status = "PASS"`
        - otherwise, set rule status to FAIL and provide the note that the expected UEF is less than the required UEF: `else: rule_status = "FAIL"; rule_note = "The modeled Uniform energy Factor (UEF - " + uniform_energy_factor + ") does not equal required (" + expected_UEF + ")"`
      - otherwise, set rule status to UNDETERMINED and provide a note: `else: rule_status = "UNDETERMINED"; rule_note = "Uniform Energy Factor is required but not provided"`
    - else, if the storage tank is greater than 55 and less than 100 gallons, Appendix F provides a heat pump efficiency, which may be an error.  return UNDETERMINED: `elif storage_volume <=100 and storage_volume > 55:`
      - set rule_status to UNDETERMINED: `rule_status = "UNDETERMINED"`
      - include a note: `rule_note = "The storage tank is between 2 and 20 gallons and based on the size categories in ASHRAE 90.1 Table 7.8 and Appendix F it would not be classified as an electric storage water heater. Consequently, this rule was not able to be assessed for this service water heater."`
      - go to rule assertion: `GO TO RULE ASSERTION`
    - else if the storage volume is between 2 and 20 gallons, in which case there is no rating in APPENDIX F.  set rule status to UNDETERMINED: `elif storage_volume < 20:`
      - set the rule status to UNDETERMINED: `rule_status = "UNDETERMINED"`
      - add a note: `rule_note = "The storage tank is between 2 and 20 gallons.  Appendix F doesn't provide an efficiency for water heaters of this size."`
      - go to rule assertion: `GO TO RULE ASSERTION`
  - otherwise, continue with rule logic: `else:`
    - check electric storage water heaters with capacity greater than 12 kW: `if swh_type == "ELECTRIC_RESISTANCE_STORAGE" and input_capacity > 40945.7 (btu/hr):`
      - check that the capacity_per_volume < 4000 btu/hr/gallon: `if capacity_per_volume < 4000:`
        - calculate the standby loss target: `standby_loss_target = 0.3 + (27/swh_eq.distribution_system.tank.storage_volume)`
        - 
        - if the standby_loss is less than or equal to the target, set the rule_status to PASS: `if standby_loss <= standby_loss_target: rule_status: "PASS"`
        - otherwise: `else:`
          - set the note to indicate that the standby_loss is higher than the maximum allowed: `rule_note = "Standby Loss is higher than required by Table 7.8"`
      - otherwise: `else:`
        - set the note to indicate that the capacity per volume exceeds the limit: `rule_note = "Capacity per volume exceeds the limit of 4000 btu/hr/gallon for Electric Storage Water Heaters` 
    - check if the water heater is gas storage: `if swh_type == "GAS_STORAGE":`
      - check if the capacity is <= 75,000 btu/hr: `if input_capacity <= 75000:`
        - if the storage volume is between 20 and 55 gallons: `if storage_volume >= 20 and storage_volume <= 55:`
          - determine the UEF based on the draw pattern for VERY_SMALL: `if draw_pattern == "VERY_SMALL": expected_uef = 0.3456 – (0.0020 × storage_volume)`
          - determine the UEF based on the draw pattern for LOW: `if draw_pattern == "LOW": expected_uef = 0.5982 – (0.0019 × storage_volume)`
          - determine the UEF based on the draw pattern for MEDIUM: `if draw_pattern == "MEDIUM": expected_uef = 0.6483 – (0.0017 × storage_volume)`
          - determine the UEF based on the draw pattern for HIGH: `if draw_pattern == "HIGH": expected_uef = 0.6920 – (0.0013 × storage_volume)`
          - check whether the uniform_energy_factor is valid: `if uniform_energy_factor != NULL
            - check if the actual uniform_energy_factor is equals the expected: `if uniform_energy_factor == expected_UEF:`
              - set rule_status to "PASS": `rule_status = "PASS"`
            - otherwise, set rule status to FAIL and provide the note that the expected UEF is less than the required UEF: `else: rule_status = "FAIL"; rule_note = "The modeled Uniform energy Factor (UEF - " + uniform_energy_factor + ") does not equal the required (" + expected_UEF + ")"`
          - otherwise, set rule status to UNDETERMINED and provide a note: `else: rule_status = "UNDETERMINED"; rule_note = "Uniform Energy Factor is required but not provided"`
        - otherwise, if the storage volume is less than 20 gallons, we will not be able to evaluate the rule logic,  Provide a note and continue to rule evaluation: `elif storage_volume < 20: rule_note = "The storage tank volume is less than 20 gallons and the input capacity is <= 75,000 Btuh and based on the size categories in ASHRAE 90.1 Table 7.8 and Appendix F it would not be classified as a gas storage water heater. Consequently, this rule was not able to be assessed for this service water heater. "; GO TO RULE ASSERTION`
        - otherwise, if the storage volume is between 55 and 100 gallons: `elif storage_volume <= 100:`
          - determine the UEF based on the draw pattern for VERY_SMALL: `if draw_pattern == "VERY_SMALL": expected_uef = 0.6470 – (0.0006 × storage_volume)`
          - determine the UEF based on the draw pattern for LOW: `if draw_pattern == "LOW": expected_uef = 0.7689 – (0.0005 × storage_volume)`
          - determine the UEF based on the draw pattern for MEDIUM: `if draw_pattern == "MEDIUM": expected_uef = 0.7897 – (0.0004 × storage_volume)`
          - determine the UEF based on the draw pattern for HIGH: `if draw_pattern == "HIGH": expected_uef = 0.8072 – (0.0003 × storage_volume)`
          - check whether the uniform_energy_factor is valid: `if uniform_energy_factor != NULL
            - check if the actual uniform_energy_factor is >= to the expected: `if uniform_energy_factor == expected_UEF:`
              - set rule_status to "PASS": `rule_status = "PASS"`
            - otherwise, set rule status to FAIL and provide the note that the expected UEF is does not equal the required UEF: `else: rule_status = "FAIL"; rule_note = "The modeled Uniform energy Factor (UEF - " + uniform_energy_factor + ") does not equal the required (" + expected_UEF + ")"`
          - otherwise, set rule status to UNDETERMINED and provide a note: `else: rule_status = "UNDETERMINED"; rule_note = "Uniform Energy Factor is required but not provided"`
        
        - otherwise, the storage volume is greater than 100 gallons, which is not covered by Appendix F: `else:`
          - create a note indicating that gas water heaters greater with input capacity < 75,000 btu/hr and the given storage volume are not covered under Appendix F: `rule_note: "The storage tank volume is greater than 100 gallons and the input capacity is <= 75,000 Btuh and based on the size categories in ASHRAE 90.1 Table 7.8 and Appendix F it would not be classified as a gas storage water heater. Consequently, this rule was not able to be assessed for this service water heater."`
          - change rule_status to UNDETERMINED: `rule_status = "UNDETERMINED"`
      - check if the capacity <= 105,000 btu/hr: `elif input_capacity <= 105000:`
        - the capacity per volume should be < 4000 btu/hr/gallon: `if capacity_per_volume >= 4000:`
          - add the to the rule note: `rule_note += "Based on the size categories for gas storage water heaters in ASHRAE 90.1 Table 7.8, gas storage water heaters with an input capacity between 75,000 and 105,000 btu/hr shall have a capacity per volume of 4,000 btu/hr/gallon. This water heater has a capacity per gallon of " + capacity_per_volume + " btu/hr/gallon.  Consequently, this rule was not able to be assesed for this service water heater.  "`
          - set has_fault to true: `has_fault = true`
        - the volume should be <= 120 gallons: `if storage_volume > 120:`
          - add to the rule note: `rule_note += "Based on the size categories for gas storage water heaters in ASHRAE 90.1 Table 7.8, gas storage water heaters with an input capacity between 75,000 and 105,000 btu/hr shall have a storage capacity of <= 120 gallons. The storage capacity of this water heater is " + storage_volume + " gallons.  "`
          - set has_fault to true: `has_fault = true`
        - the supply water temperature should be <= 180F: `if shw_eq.setpoint_temperature > 180:`
          - add to the rule note: `rule_note += "Based on the size categories for gas storage water heaters in ASHRAE 90.1 Table 7.8, gas storage water heaters with an input capacity between 75,000 and 105,000 btu/hr shall have a setpoint temperature of 180F.  The setpoint temperature of this water heater is " + shw_eq.setpoint_temperature + "F.  "`
          - set has_fault to true: `has_fault = true`
        - calculate the expected efficiency for VERY_SMALL draw pattern: `if draw_pattern == "VERY_SMALL": expected_UEF = 0.2674 – (0.0009 * volume)`
        - calculate the expected efficiency for LOW draw pattern: `if draw_pattern == "LOW": expected_UEF = 0.5362 – (0.0012 * volume)`
        - calculate the expected efficiency for MEDIUM draw pattern: `if draw_pattern == "MEDIUM": expected_UEF = 0.6002 – (0.0011 * volume)`
        - calculate the expected efficiency for HIGH draw pattern: `if draw_pattern == "HIGH": expected_UEF = 0.6597 – (0.0009 * volume)`
        - check whether the uniform_energy_factor is valid: `if uniform_energy_factor != NULL
          - check if the actual uniform_energy_factor equal to the expected: `if uniform_energy_factor == expected_UEF and !has_faults:`
            - set rule_status to "PASS": `rule_status = "PASS"`
        - otherwise, set rule status to UNDETERMINED and provide a note: `else: rule_status = "UNDETERMINED"; rule_note = "Uniform Energy Factor is required but not provided"`
      - otherwise the capacity is > 105,000 btu/hr: `else:`
        - the capacity per volume should be < 4000 btu/hr/gallon: `if capacity_per_volume >= 4000:`
          - add to the rule note: `rule_note += "Based on the size categories for gas storage water heaters in ASHRAE 90.1 Table 7.8, gas storage water heaters with an input capacity greater than 105,000 btu/hr shall have a capacity per volume of 4,000 btu/hr/gallon. This water heater has a capacity per gallon of " + capacity_per_volume + " btu/hr/gallon.  Consequently, this rule was not able to be assesed for this service water heater.  "`
          - set has_fault to true: `has_fault = true`
        - calculate the expected_thermal_efficiency : `expected_thermal_efficiency = 0.8`
        - calculate max_standby_loss (btu/hr): `max_standby_loss = (input_capacity/800 + 110 * sqrt(volume))`
        - make sure that the thermal efficiency is not NULL: `if thermal_efficiency != NULL:`
          - check whether the uniform_energy_factor is valid: `if uniform_energy_factor != NULL`
            - check if the actual uniform_energy_factor is == to the expected: `if shw_eq.thermal_efficiency == expected_thermal_efficiency and standby_loss <= max_standby_loss and !has_faults:`
              - set rule_status to "PASS": `rule_status = "PASS"`
          - otherwise, set rule status to UNDETERMINED and provide a note: `else: rule_status = "UNDETERMINED"; rule_note = "Uniform Energy Factor is required but not provided"`
        - otherwise set the rule status to UNDETERMINED and provide a note: `else: rule_status = "UNDETERMINED"; rule_note = "No thermal efficiency provided.  Expected thermal efficiency is: " + expected_thermal_efficiency`
    
   **Rule Assertion - ServiceWaterHeatingEquipment:**
  - Case1: swh_type is INSTANTANEOUS - there is no baseline instantaneous water heater types: `if swh_type == "INSTANTANEOUS": UNDETERMINED; rule_note = "There baseline water heater is of an Instantaneous type.  There are no acceptable instantaneous baseline water heaters in Table G3.1.1-2."`
  - Case2: rule_status is PASS: `if rule_status == "PASS": PASS`.
  - Case3: rule_status is UNDETERMINED, UNDETERMINED & return rule_note: `elif rule_status == "UNDETERMINED": UNDETERMINED; rule_note`
  - Case4: rule_status is FAIL, FAIL & return rule_note: `elif rule_status == "FAIL": FAIL; rule_note`


**Notes:**

1. standby loss calculated based on https://www.energy.ca.gov/sites/default/files/2021-11/CBECC-Res_UserManual_2019.2.0_ada.pdf 9.6.4.8
2. what category to use of fuel type is Propane? Gas or Oil?
3. how to calculate the subcategory or rating condition (btu/hr/gallon) to confirm that this requirement is met?
4. draw_pattern - not currently included in the schema, but could be inferred from first_hour_rating based on Table I on page 9: https://www.govinfo.gov/content/pkg/CFR-2016-title10-vol3/pdf/CFR-2016-title10-vol3-part430-subpartB-appE.pdf
5. This question was discussed on 5/29/2024 and agreed that this exception wouldn't be triggered by a baseline system.  Original question: Would the exception to 7.4.2 ever be applicable to a baseline system?  The exceptions is: "All water heaters and hot-water supply boilers having more than 140 gal of storage capacity are not required to meet the standby loss (SL) requirements of Table 7.8 when 
    1. the tank surface is thermally insulated to R-12.5,
    2. a standing pilot light is not installed, and
    3. gas- or oil-fired storage water heaters have a flue damper or fan-assisted combustion.
6. Written assuming the issue: https://github.com/open229/ruleset-model-description-schema/issues/287 will be accepted as part of the schema

- get the standby loss (see note 1 for calculation source): `standby_loss = swh_eq.standby_loss_fraction * 8.25 * volume * 70`

**[Back](../_toc.md)**
