# HVAC_SystemZoneAssignment - Rule 18-22
**Schema Version:** 0.0.22  

**Rule ID:** 18-22
**Rule Description:** For Systems 5, 6, 7, and 8, each floor shall be modeled with a separate HVAC system. , with the exception of baseline system 5 or 7 serving laboratory spaces.
**Appendix G Section:** Section 18 HVAC_SystemZoneAssignment  
**Appendix G Section Reference:** G3.1.1.a.4

**Applicability:** 

1. System type is 5,6,7 or 8
2. applies to all zones, except laboratories and only when the system type is 5 or 7

**Manual Check:** Yes  
**Evaluation Context:** Evaluate whether each system serves an entire floor

**Data Lookup:**   
**Function Call:** 

1. get_baseline_system_types()
2. get_dict_of_zones_and_terminal_units_served_by_hvac_sys()
3. get_zone_target_baseline_system()



## Rule Logic:  
- get the list of all the baseline system types that exist in the baseline model: `baseline_system_types = get_baseline_system_types(B-RMD)`
- get the list of HVAC systems and the zones that they serve: `hvac_systems_zones_terminal_units = get_dict_of_zones_and_terminal_units_served_by_hvac_sys(B-RMI)`
- get the zone target baseline systems: `zone_target_baseline_system = get_zone_target_baseline_system(P-RMD,B-RMD)`

- create a dict of floors and the zones in each floor.  The keys will be floor names and the values will be a list of zones: `floors_and_zones = {}`
- we already have a list of zones in zone_target_baseline_system, so loop through the zones here: `for zone in zone_target_baseline_system:`
	- add the floor_name key if it doesn't already exist yet: `floors_and_zones[zone.floor_name] = floors_and_zones[zone.floor_name] or []`
	- append the zone to the list: `floors_and_zones[zone.floor_name].append(zone)`


- loop through the systems types in baseline_system_types: `for system_type in baseline_system_types:`
	- check whether the system type is one of system type 5,6,7, or 8: `if system_type[0:5] in ["SYS-5","SYS-6","SYS-7","SYS-8"]:`
		- loop through the hvac systems of this type and do the rule check: `for system_id in baseline_system_types[system_type]:`
			- now we need a list of the zones served by the hvac system: `zones_served_by_system = hvac_systems_zones_terminal_units[system_id]["ZONE_LIST"]`
			- we also need to find out what floor the HVAC system is serving, we'll check just the first zone: `floor_name = zones_served_by_system[0].floor_name`
			- now we do two checks:
				1. all zones served by the system are on the same floor
				2. all zones on the floor are served by this system
				3. zones that are not served by the same system are allowed to when their expected_system_type is different from the system type being tested (for example, if we are looking at a "SYS-5" HVAC system and the zone's expected_system_type is "SYS-3", then we can assume that the zone met one of the exceptions of G3.1.1 and has a dedicated system)
			- create a variable all_zones_on_same_floor that is a boolean: `all_zones_on_same_floor = true`
			- loop through all zones in the zones_served_by_system: `for zone in zones_served_by_system:`
				- if the zone floor name does not equal floor_name, the zone is not on the same floor: `if zone.floor_name == floor_name:`
					- set all_zones_on_same_floor to FALSE: `all_zones_on_same_floor = FALSE`
			- create a boolean passes_test and set to FALSE: `passes_test = FALSE`
			- continue only if all_zones_on_same_floor equals true: `if all_zones_on_same_floor == TRUE:`
				- set passes_test to TRUE: `passes_test = TRUE`
				- now check all the zones on the floor to see if they have the same system.  Start by looping through the zones in the floors_and_zones[floor_name]: `for zone in floors_and_zones[floor_name]:`
					- if this zone is not included in the list of zones served by the system: `if zone not in zones_served_by_system:`
						- check if the zone's expected baseline system type is the one we're currenlty checking (ie, 5, 6, 7 or 8): `if zone_target_baseline_system[zone]["EXPECTED_SYSTEM_TYPE"] == system_type[0:5]:`
							- this means that the zone does not meet any of the exceptions of G3.1.1, so it should have the target system type AND be on the same system as the rest of the floor, set passes_test to FALSE: `passes_test = FALSE`

			- there are some systems 5 and 7 which serve laboratory zones, which will serve only those zones, so check first if the test has failed: `if not passes_test:`
				- check whether it is SYS-5 or SYS-7: `if system_type[0:5] in ["SYS-5","SYS-7"]:`
					- create a boolean all_zones_labs: `all_zones_labs = TRUE`
					- look at all the zones served by the system and see if they are all laboratory zones: `for zone in zones_served_by_system:`
						- create a boolean zone_is_a_lab and set it to false: `zone_is_a_lab = FALSE`
						- look through all the spaces in the zone: `for space in zone.spaces:`
							- set zone_is_a_lab to true if the space.space_function == LABORATORY: `zone_is_a_lab = TRUE if space.space_function == "LABORATORY"`
						- if the zone is not a lab, then set all_zones_lab boolean to false: `all_zones_labs = FALSE if not zone_is_a_lab`


  **Rule Assertion - Zone:**

  - Case 1: The system is not one of the tested system types, the rule is not applicable: `NOT_APPLICABLE if system_type[0:5] not in ["SYS-5","SYS-6","SYS-7","SYS-8"]`
  
  - Case 2: All zones on the floor, excepting the ones that meet G3.1.1 exceptions are served by the same system: `PASS if passes_test = TRUE`
  
  - Case 3: The system is type 5 or 7, and all the zones are labs, the rule is not applicable: `NOT_APPLICABLE if not all_zones_labs`

  - Case 4: Else: `else: FAIL`

**Notes:**

1. where in ASHRAE does the laboratory exception come from?  I think it should really be when a zone has met one of the G3.1.1 exceptions & has a dedicated individual system type

**[Back](../_toc.md)**
